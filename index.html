<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trie (A ‚Üí Z) ‚Äî Visualizador</title>

  <style>
    body {
      font-family: Inter, system-ui, sans-serif;
      padding: 16px;
      background: #f7fafc;
      color: #0f172a;
    }

    h2, h3 {
      margin-top: 0;
    }

    .controls {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      align-items: center;
    }

    input {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #cbd5e1;
    }

    button {
      padding: 8px 12px;
      border-radius: 8px;
      border: 0;
      background: #2563eb;
      color: white;
      cursor: pointer;
    }

    button.secondary {
      background: #64748b;
    }

   #canvasWrap {
  width: 100%;
  height: 600px;          /* ‚Üê Tama√±o fijo */
  overflow: auto;         /* ‚Üê Activa scroll */
  border: 1px solid #cbd5e1;
  position: relative;     

}


  svg {
  width: 100% !important;
  height: 100% !important;
  min-width: 100% !important;
  min-height: 100% !important;

  /* ¬°ESTE es el truco final! */
  max-width: 100% !important;
  max-height: 100% !important;

  overflow: visible;
}

    .node circle {
      stroke: #0f172a;
      stroke-width: 1.2px;
      fill: #e6eef8;
    }

    .node text {
      font-size: 12px;
      dominant-baseline: middle;
      text-anchor: middle;
    }

    .edge {
      stroke: #9aaed6;
      stroke-width: 1.2px;
    }

    .legend {
      margin-top: 8px;
      font-size: 13px;
    }

    footer {
      margin-top: 10px;
      color: #475569;
      font-size: 13px;
    }

  </style>
</head>

<body>

  <h2>Trie visual (A ‚Üí Z)</h2>
  <h3 id="wordDisplay">Palabra: </h3>

<div id="wordDisplay" style="margin:10px; font-size:18px; font-weight:bold;"></div>
<div id="validMsg" style="margin:10px; color:#0a0; font-size:16px;"></div>

  <div class="controls">
    <button id="buildAZ">Generar trie: a ‚Üí z</button>
    <input id="wordInput" placeholder="Agregar palabra" />
    <button id="addWord">Insertar palabra</button>
    <button id="clear" class="secondary">Limpiar</button>

    <label style="margin-left:8px;font-size:13px;color:#334155">
      Nodos por defecto: solo letras a-z como hijos del root.
    </label>
  </div>

  <div id="canvasWrap">
    <svg id="svgRoot" viewBox="0 0 1200 720"></svg>
  </div>

  <footer>Hecho por karen lopez morales y jorge luis pizano saucedo</footer>
<script>
let palabrasBase = {};

// Cargar el diccionario
// Cargar el diccionario EXACTO que me diste
const palabras = {
  "agua": ["aguacero","aguamarina","aguafiestas","aguacate","aguadura"],
  "boca": ["bocadillo","bocacalle","bocazas","bocanada","bocadear"],
  "casa": ["casamiento","casamata","casaca","casamentero","casar√≥n"],
  "dulce": ["dulcer√≠a","dulcecito","dulcemente","dulcero","dulcecillo"],
  "eco": ["ecolog√≠a","ecol√≥gico","economista","econ√≥mico","ecograf√≠a"],
  "flor": ["florero","florido","floral","floraci√≥n","florister√≠a"],
  "gato": ["gatopardo","gatomaquia","gatoide","gatoterapia"],
  "hoja": ["hojalata","hojaldre","hojarasca","hojarascoso","hojear"],
  "isla": ["islote","islita","isle√±o","isla√±o","islario"],
  "juego": ["jueguito","jueguete","juegazo","juegosfera","jueg√≥dromo"],
  "kilo": ["kilogramo","kil√≥metro","kilovatio","kilojoule","kilopondio"],
  "luna": ["lun√°tico","lunar","lunario","luneta","lunisolar"],
  "mano": ["manojo","manosear","man√≥metro","manopla"],
  "nube": ["nubecilla","nubecita","nubelin","nubisfera"],
  "ojo": ["ojal","ojeada","ojeroso","ojete","ojeador"],
  "pan": ["panadero","panader√≠a","panecillo","panceta","panfleto"],
  "queso": ["quesito","queser√≠a","quesero","quesal","quesillo"],
  "rosa": ["rosal","rosado","rosaleda","rosarino","ros√°ceo"],
  "sol": ["soleado","solero","solapa","solano","solitario"],
  "tierra": ["tierrazo","tierrero","tierrita","tierral"],
  "uva": ["uvita","uvero","uval","uvado","uvario"],
  "vaso": ["vasito","vasija","vasoforma","vasoterapia"],
  "web": ["webmaster","webinario","webserie","webc√≥mic","webgraf√≠a"],
  "xilo": ["xil√≥fono","xilograf√≠a","xilotipo","xiloide","xiloplastia"],
  "yema": ["yemita","yemer√≠a","yemero","yemasco","yemado"],
  "zapato": ["zapatito","zapater√≠a","zapatero","zapat√≥n","zapateado"]
};


/* ============================================
      TRIE
============================================ */
class TrieNode {
  constructor(letter = "") {
    this.letter = letter;
    this.children = new Map();
    this.parent = null;
  }
}

class Trie {
  constructor() {
    this.root = new TrieNode();
    this.current = this.root;
    this.selectedPath = [];
  }

  expandAZ(node) {
    node.children.clear();
    for (const c of "abcdefghijklmnopqrstuvwxyz") {
      const child = new TrieNode(c);
      child.parent = node;
      node.children.set(c, child);
    }
  }

  reset() {
    this.root = new TrieNode();
    this.current = this.root;
    this.selectedPath = [];
  }
}
function validarPalabra(palabra) {
  // 1Ô∏è‚É£ Coincidencia exacta
  if (palabrasBase[palabra]) {
    return { tipo: "exacta", significado: palabrasBase[palabra] };
  }

  // 2Ô∏è‚É£ Coincidencia como prefijo
  for (const key in palabrasBase) {
    if (key.startsWith(palabra)) {
      return { tipo: "prefijo" };
    }
  }

  // 3Ô∏è‚É£ No coincide
  return { tipo: "invalida" };
}

/* ============================================
      LAYOUT
============================================ */
function layoutForFocus(node) {
  const cx = 200;
  const cy = 120;

  node._x = cx;
  node._y = cy;

  const kids = [...node.children.values()];
  const gap = 36;

  const totalW = (kids.length - 1) * gap;
  const startX = cx - totalW / 2;

  for (let i = 0; i < kids.length; i++) {
    kids[i]._x = startX + i * gap;
    kids[i]._y = cy + 120;
  }
}

// Convertir el objeto de palabras en un diccionario usable
Object.entries(palabras).forEach(([base, lista]) => {
  const raiz = base.toLowerCase();

  if (!palabrasBase[raiz]) palabrasBase[raiz] = [];

  lista.forEach(derivada => {
    palabrasBase[raiz].push(derivada.toLowerCase());
  });
});



/* ============================================
      RENDER
============================================ */
function renderFocused(svg, trie) {
  svg.innerHTML = "";

  /* Camino desde root hasta nodo actual */
  let chain = [];
  let temp = trie.current;

  while (temp) {
    chain.push(temp);
    temp = temp.parent;
  }

  chain = chain.reverse();

  const baseX = 700;
  const baseY = 60;
  const stepY = 70;

  svg.setAttribute("height", Math.max(400, chain.length * 80));
  svg.setAttribute("width", 1200);

  /* Conexiones verticales */
  for (let i = 0; i < chain.length - 1; i++) {
    const length = trie.selectedPath.length;
    const shrink = length <= 2 ? 0 : (length - 2) * 5;
    const offset = Math.min(25, shrink);

    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
    line.classList.add("edge");

    line.setAttribute("x1", baseX);
    line.setAttribute("y1", baseY + i * stepY + 20 + offset);

    line.setAttribute("x2", baseX);
    line.setAttribute("y2", baseY + (i + 1) * stepY - 20 - offset);

    svg.appendChild(line);
  }

  /* Nodos verticales */
  for (let i = 0; i < chain.length; i++) {
    const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
    g.classList.add("node");

    const length = trie.selectedPath.length;
    const shrink = length <= 2 ? 0 : (length - 2) * 5;
    const maxShrink = Math.min(25, shrink);

    const dynamicStep = stepY - maxShrink;
    const posY = baseY + i * dynamicStep;

    const r = length <= 3 ? 16 : Math.max(8, 16 - (length - 3) * 2);
    const fontSize = length <= 3 ? 12 : Math.max(7, 12 - (length - 3));

    g.setAttribute("transform", `translate(${baseX}, ${posY})`);

    g.innerHTML = `
      <circle r="${r}"></circle>
      <text style="font-size:${fontSize}px">${chain[i].letter || "‚Ä¢"}</text>
    `;

    svg.appendChild(g);
  }

  /* Mostrar palabra */
  document.getElementById("wordDisplay").textContent =
    "Palabra: " + trie.selectedPath.join("");

  /* Layout √°rea A-Z */
  layoutForFocus(trie.current);

  svg.setAttribute("viewBox", "0 0 900 600");

  /* L√≠neas hacia A-Z */
  for (const child of trie.current.children.values()) {
    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
    line.classList.add("edge");

    line.setAttribute("x1", trie.current._x);
    line.setAttribute("y1", trie.current._y + 22);
    line.setAttribute("x2", child._x);
    line.setAttribute("y2", child._y - 22);

    line.style.opacity = 0;
    line.style.transition = "opacity .28s";

    svg.appendChild(line);
    setTimeout(() => (line.style.opacity = 1), 80);
  }

  /* Opciones A-Z */
  let i = 0;

  for (const child of trie.current.children.values()) {
    const g = document.createElementNS("http://www.w3.org/2000/svg", "g");

    g.classList.add("node", "option");

    g.setAttribute("transform", `translate(${child._x}, ${child._y}) scale(.2)`);
    g.style.opacity = 0;
    g.style.transition = "transform .28s ease, opacity .28s ease";

    g.innerHTML = `
      <circle r="14"></circle>
      <text>${child.letter}</text>
    `;

    /* =============================
          CLICK ‚Üí AVANZAR LETRA
    ============================== */
g.onclick = (ev) => {
  ev.stopPropagation();

  // Animaci√≥n
  g.setAttribute(
    "transform",
    `translate(${child._x}, ${child._y}) scale(1.4)`
  );
  svg.style.pointerEvents = "none";

  setTimeout(() => {

    // üîµ 1. Agregar letra seleccionada
    trie.selectedPath.push(child.letter);
    const palabraFormada = trie.selectedPath.join("").toLowerCase();

    console.log("Usuario form√≥:", palabraFormada);

    // --- VALIDACI√ìN COMPLETA ---

    // Es coincidencia EXACTA
    const esPalabraExacta =
      palabrasBase[palabraFormada] ||       // ra√≠z exacta
      Object.values(palabrasBase).flat().includes(palabraFormada); // derivado exacto

    // Es PREFIJO v√°lido
    const esPrefijo =
      Object.keys(palabrasBase).some(k => k.startsWith(palabraFormada)) ||
      Object.values(palabrasBase).flat().some(p => p.startsWith(palabraFormada));

    // --- ACCIONES SEG√öN VALIDACI√ìN ---

    if (esPalabraExacta) {
      alert(`‚úî "${palabraFormada}" es una palabra v√°lida en el diccionario.`);
    } 
    else if (!esPrefijo) {
      // ‚ùå NO coincide NADA ‚Üí error ‚Üí reset
      alert(`‚ùå "${palabraFormada}" no es v√°lida.`);

      trie.selectedPath.pop();
      trie.current= trie.current.parent || trie.root;

      trie.expandAZ(trie.current);
      renderFocused(svg, trie);
      svg.style.pointerEvents = "auto";
      return;
    }

    // --- SI ES PREFIJO V√ÅLIDO, SEGUIMOS MOSTRANDO LETRAS ---

    const newNode = new TrieNode(child.letter);
    newNode.parent = trie.current;
    trie.current = newNode;

    trie.expandAZ(trie.current);
    renderFocused(svg, trie);
    svg.style.pointerEvents = "auto";

  }, 320);
};



    svg.appendChild(g);

    /* Animaci√≥n de aparici√≥n */
    setTimeout(() => {
      g.style.opacity = 1;
      g.setAttribute("transform", `translate(${child._x}, ${child._y}) scale(1)`);
    }, 120 + i * 12);

    i++;
  }
}

/* ============================================
      INICIALIZACI√ìN
============================================ */
const trie = new Trie();
const svg = document.getElementById("svgRoot");

trie.expandAZ(trie.root);
trie.current = trie.root;

renderFocused(svg, trie);

document.getElementById("clear").onclick = () => {
  trie.reset();
  trie.expandAZ(trie.root);
  renderFocused(svg, trie);
};

document.getElementById("buildAZ").onclick = () => {
  trie.reset();
  trie.expandAZ(trie.root);
  renderFocused(svg, trie);
};
/* ============================================
      AGREGAR PALABRA DESDE wordInput
============================================ */
document.getElementById("addWord").onclick = () => {
  let w = document.getElementById("wordInput").value.trim().toLowerCase();

  if (!w) {
    alert("Ingresa una palabra.");
    return;
  }

  if (!/^[a-z√°√©√≠√≥√∫√º√±]+$/i.test(w)) {
    alert("Solo se permiten letras.");
    return;
  }

  // Obtiene la ra√≠z inicial como en tu diccionario actual
  const raiz = w.slice(0, 3);  // ‚Üê puedes cambiar a 4 si prefieres

  // Si no existe la ra√≠z, se crea
  if (!palabrasBase[raiz]) {
    palabrasBase[raiz] = [];
  }

  // Evitar duplicados
  if (!palabrasBase[raiz].includes(w)) {
    palabrasBase[raiz].push(w);
  }

  alert(`‚úî La palabra "${w}" fue agregada correctamente bajo la ra√≠z "${raiz}".`);

  // Limpia input
  document.getElementById("wordInput").value = "";

  // Reiniciar el trie para usar la palabra en la navegaci√≥n
  trie.reset();
  trie.expandAZ(trie.root);
  renderFocused(svg, trie);
};

</script>

</body>
</html>
